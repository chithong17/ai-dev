openapi: 3.0.3
info:
  title: COBOL-AIRLINES API
  version: 1.0.0
  description: API for migrated COBOL-AIRLINES system
servers:
  - url: /api
paths:
  /auth/login:
    post:
      summary: Authenticate user (login)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
  /flights/search:
    get:
      summary: Search flights
      parameters:
        - in: query
          name: flightNum
          schema:
            type: string
        - in: query
          name: date
          schema:
            type: string
            format: date
        - in: query
          name: depAirport
          schema:
            type: string
        - in: query
          name: arrAirport
          schema:
            type: string
      responses:
        '200':
          description: A list of flights (max 10)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FlightDTO'
        '400':
          description: Invalid input
  /bookings/validate-step1:
    post:
      summary: Validate booking step 1 (client + flight exist; compute price)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingValidateRequest'
      responses:
        '200':
          description: Booking quote
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingQuote'
        '400':
          description: Validation error (malformed input)
        '404':
          description: Client or Flight not found (legacy error messages returned in body)
components:
  schemas:
    AuthRequest:
      type: object
      properties:
        empid:
          type: string
        password:
          type: string
      required: [empid, password]
    AuthResponse:
      type: object
      properties:
        token:
          type: string
        empid:
          type: string
        deptid:
          type: integer
      required: [token, empid, deptid]
    FlightDTO:
      type: object
      properties:
        flightId:
          type: integer
        flightNum:
          type: string
        flightDate:
          type: string
          format: date
        airportDep:
          type: string
        airportArr:
          type: string
        depTime:
          type: string
        arrTime:
          type: string
    BookingValidateRequest:
      type: object
      properties:
        clientId:
          type: string
        flightNum:
          type: string
        date:
          type: string
          format: date
        passengerCount:
          type: integer
      required: [clientId, flightNum, date, passengerCount]
    BookingQuote:
      type: object
      properties:
        client:
          type: object
          properties:
            clientId:
              type: string
            firstName:
              type: string
            lastName:
              type: string
        flight:
          $ref: '#/components/schemas/FlightDTO'
        unitPrice:
          type: number
          format: float
        totalPrice:
          type: number
          format: float
        passengerCount:
          type: integer
